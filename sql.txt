
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;
CREATE TABLE tbl_file (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    unique_identifier character varying(50) NOT NULL,
    file_name character varying(150) NOT NULL,
    file_size bigint NOT NULL,
    file_created_date timestamp with time zone NOT NULL,
    file_extension character varying(10) NOT NULL,
    checksum character varying(150) NOT NULL,
    checksum_algorithm character varying(10) NOT NULL,
    number_of_chunks integer NOT NULL,
    create_date timestamp with time zone NOT NULL,
    delete_date timestamp with time zone,
    file_process_status character varying(20) NOT NULL,
    last_update_date timestamp with time zone,
    CONSTRAINT "PK_tbl_file" PRIMARY KEY (id)
);

CREATE TABLE tbl_stored_file (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    file_name character varying(150) NOT NULL,
    content text NOT NULL,
    create_date timestamp with time zone NOT NULL,
    delete_date timestamp with time zone,
    CONSTRAINT "PK_tbl_stored_file" PRIMARY KEY (id)
);

CREATE TABLE tbl_file_chunk (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    file_id integer NOT NULL,
    chunk_index integer NOT NULL,
    chunk_name character varying(150) NOT NULL,
    chunk_size bigint NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    storage_provider character varying(50) NOT NULL,
    file_process_status character varying(50) NOT NULL,
    upload_error_reason text NOT NULL,
    CONSTRAINT "PK_tbl_file_chunk" PRIMARY KEY (id),
    CONSTRAINT "FK_tbl_file_chunk_tbl_file_file_id" FOREIGN KEY (file_id) REFERENCES tbl_file (id) ON DELETE CASCADE
);

CREATE UNIQUE INDEX "IX_tbl_file_unique_identifier" ON tbl_file (unique_identifier);

CREATE INDEX "IX_tbl_file_chunk_file_id" ON tbl_file_chunk (file_id);

CREATE UNIQUE INDEX "IX_tbl_stored_file_file_name" ON tbl_stored_file (file_name);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250724055820_InitialCreate', '9.0.7');

COMMIT;

